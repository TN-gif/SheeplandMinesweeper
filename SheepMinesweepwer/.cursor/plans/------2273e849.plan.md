<!-- 2273e849-185f-4151-9d50-ce5f4e99e2b3 56955271-e00a-4f6e-9e82-ed84a7fb11f8 -->
# 重写游戏页面布局实施计划

## 概述

根据design-summary.txt中的设计规范，重新编写6个页面的UI布局，使用Stack+绝对定位实现像素级精确布局。保留所有现有的业务逻辑（游戏逻辑、音乐控制、动画效果等），仅修改UI布局结构。

## 实施原则

1. **布局方式**: Stack + position 绝对定位（360×792vp）
2. **字体应用**: 使用FontManager统一管理Muyao-Softbrush字体
3. **图片处理**: 使用ImageFit.Cover避免拉伸
4. **逻辑保留**: 完全保留现有的游戏逻辑、音乐系统、动画效果
5. **主题切换**: 挑战/自定义/冒险模式页面随主题变化背景

## 资源路径清单

### 背景图片

- 主题背景: `images/background/喜羊羊.jpg` (美羊羊/懒羊羊/沸羊羊/暖羊羊/慢羊羊.jpg)
- 游戏背景: `images/background/游戏背景.jpg`
- 设置背景: `images/background/设置页面.jpg`
- 成就背景: `images/background/成就背景.jpg`

### 导航栏图标

- 成就: `images/icon/成就.png`
- 游戏: `images/icon/游戏.png`
- 设置: `images/icon/设置.png`
- 返回: `images/icon/返回.png`

### 游戏专用图标

- 放大镜: `images/icon/放大镜.png`
- 时钟: `images/icon/时钟.png`
- 灰太狼: `images/icon/灰太狼.jpg`
- 土地: `images/icon/土地.png`
- 草地: `images/icon/草地.png`
- 路牌: `images/icon/路牌.png`
- 捕兽夹: `images/icon/捕兽夹.png`

## 页面实施顺序

### 1. 挑战模式页面 (LevelSelectScreen.ets)

**设计规范 (design-summary.txt: 353-720行)**

**布局结构**:

```
Stack (360×792)
├── 背景图片 (主题切换)
├── 返回按钮 (141×32, position: 18, 42)
│   ├── 返回组合 (32×32, 白色圆形背景)
│   └── 返回菜单文本 (99×32)
├── 容器2 (306×584, position: 27, 92)
│   ├── "挑战模式"标题 (306×75, position: 0, 0, 字号75vp)
│   ├── 容器1 - 关卡列表 (291×387, position: 8, 107)
│   │   ├── 初级挑战 (291×115, position: 0, 0)
│   │   ├── 中级挑战 (291×115, position: 0, 136)
│   │   └── 高级挑战 (291×115, position: 0, 272)
│   └── 自定义模式按钮 (217×58, position: 45, 526)
└── 底部导航栏 (360×47, position: 0, 717)
```

**关键尺寸**:

- 关卡卡片: 291×115vp，白色半透明背景，圆角
- 卡片内文字: 标题36vp，副标题18vp
- 按钮: 217×58vp，白色背景+黑色边框

**保留逻辑**:

- 关卡点击跳转到游戏
- 自定义按钮跳转到自定义页面
- 导航栏点击逻辑

### 2. 自定义模式页面 (LevelSelectScreen.ets - 自定义部分)

**设计规范 (design-summary.txt: 722-1153行)**

**布局结构**:

```
Stack (360×792)
├── 背景图片 (主题切换)
├── 返回按钮 (141×32, position: 18, 42)
├── "自定义模式"标题 (306×75, position: 27, 92, 字号60vp)
├── 容器7 - 输入区域 (291×365, position: 35, 192)
│   └── 容器6 (243×287, position: 24, 39)
│       ├── 行数输入 (243×79, position: 0, 0)
│       │   ├── 标签: "棋盘行数（5-30）" (30vp)
│       │   └── 输入框 (230×36, 白色背景)
│       ├── 列数输入 (243×79, position: 0, 104)
│       └── 地雷数量 (243×79, position: 0, 208)
├── 开始游戏按钮 (217×58, position: 72, 613)
└── 底部导航栏 (360×47, position: 0, 717)
```

**关键尺寸**:

- 输入框: 230×36vp，白色背景
- 标签文字: 30vp
- 输入值文字: 20vp
- 容器背景: rgba(255, 255, 255, 0.2) 半透明

**保留逻辑**:

- 输入验证（5-30范围）
- 开始游戏按钮逻辑
- 数据绑定到GameViewModel

### 3. 冒险模式页面 (AdventureMapScreen.ets)

**设计规范 (design-summary.txt: 1155-1451行)**

**布局结构**:

```
Stack (360×792)
├── 背景图片 (主题切换)
├── 返回按钮 (141×32, position: 18, 42)
├── "冒险模式"标题 (306×75, position: 27, 92, 字号75vp)
├── 组合1 - 关卡区域 (318×434, position: 21, 201)
│   ├── 第一关 (224×65, position: 0, 0)
│   │   └── "1、羊村郊外" (36vp)
│   ├── 第二关 (224×65, position: 94, 129)
│   │   └── "2、青青草原" (36vp)
│   ├── 第三关 (224×65, position: 17, 257)
│   │   └── "3、狼堡对决" (36vp)
│   └── 更多按钮 (97×65, position: 176, 369)
│       └── "更多" (36vp)
└── 底部导航栏 (360×47, position: 0, 717)
```

**关键尺寸**:

- 关卡卡片: 224×65vp
- 更多按钮: 97×65vp
- 文字字号: 36vp
- 卡片背景: 白色半透明，圆角

**保留逻辑**:

- 关卡解锁状态
- 关卡点击跳转
- 更多按钮逻辑

### 4. 扫雷游戏页面 (GameBoard.ets + GameHUD.ets)

**设计规范 (design-summary.txt: 1453-2206行)**

**布局结构**:

```
Stack (360×792)
├── 背景图片 (游戏背景.jpg)
├── 返回按钮 (93×32, position: 18, 42)
├── 地雷剩余数量 (91×92, position: 56, 89)
│   ├── 灰太狼图标 (58×51)
│   └── 数量文字 (58×24, 20vp)
├── 计时功能 (91×92, position: 212, 89)
│   ├── 时钟图标 (58×51)
│   └── 时间文字 (63×24, "00:00", 20vp)
├── 道具功能 - 放大镜 (283×75, position: 39, 207)
│   ├── 放大镜图标 (58×51)
│   ├── 数量 "×3" (24vp)
│   ├── 标题 "慢羊羊的放大镜" (20vp)
│   └── 说明 "可查看任意格子是否安全" (14vp)
├── 棋盘区域 (308×336, position: 26, 308)
│   └── 动态生成的格子
└── 底部导航栏 (360×47, position: 0, 717)
```

**关键尺寸**:

- 状态区域: 91×92vp，半透明白色背景
- 图标: 58×51vp
- 道具区域: 283×75vp，半透明白色背景
- 棋盘背景: rgba(233, 243, 219, 1) 浅绿色

**保留逻辑**:

- 所有扫雷游戏逻辑（点击、长按、翻开、标记）
- 时钟计时逻辑
- 地雷计数逻辑
- 放大镜道具使用逻辑
- 棋盘缩放逻辑
- 格子状态切换（土地→草地/灰太狼，标记路牌/捕兽夹）
- 游戏胜负判断

**删除内容**:

- 震动反馈相关代码
- 除放大镜外的其他道具

### 5. 设置页面 (SettingsScreen.ets)

**设计规范 (design-summary.txt: 2208-2480行)**

**布局结构**:

```
Stack (360×792)
├── 背景图片 (设置页面.jpg)
├── 控制音量区域 (303×207, position: 29, 57)
│   ├── 背景音乐 (303×92, position: 0, 0)
│   │   ├── 标题 "背景音乐" (40vp)
│   │   └── 音量条 (303×36, position: 0, 56)
│   │       ├── 背景 rgba(190, 211, 238, 1)
│   │       ├── 进度条 Rectangle
│   │       └── 百分比文字 "27%" (20vp)
│   └── 游戏音效 (303×92, position: 0, 115)
│       └── (结构同上)
├── 选择小羊按钮 (190×58, position: 85, 627)
│   ├── 白色背景 + 黑色边框
│   └── "选择小羊" (31vp)
└── 底部导航栏 (360×47, position: 0, 717)
```

**关键尺寸**:

- 音量区域: 303×207vp
- 音量条: 303×36vp
- 标题字号: 40vp
- 百分比字号: 20vp
- 进度条颜色: rgba(190, 211, 238, 1)

**保留逻辑**:

- 音量调整逻辑（滑动/点击）
- AudioManager音量控制
- 音乐播放/暂停逻辑
- 选择小羊跳转逻辑

### 6. 成就页面 (AchievementsScreen.ets)

**设计规范 (design-summary.txt: 2482-2783行)**

**布局结构**:

```
Stack (360×792)
├── 背景图片 (成就背景.jpg)
├── 成就1 (291×115, position: 35, 68)
│   ├── 标题 "小羊诞生啦！" (36vp)
│   └── 描述 "首次通关游戏" (18vp)
├── 成就2 (291×115, position: 35, 215)
│   ├── 标题 "小小勇士" (36vp)
│   └── 描述 "累计通关10次" (18vp)
├── 成就3 (291×115, position: 35, 362)
│   ├── 标题 "羊村大守护" (36vp)
│   └── 描述 "累计通关100次" (18vp)
├── 成就4 (291×115, position: 35, 509)
│   ├── 标题 "焦炭小羊" (36vp)
│   └── 描述 "累计被灰太狼发现10次" (18vp)
└── 底部导航栏 (360×47, position: 0, 717)
```

**关键尺寸**:

- 成就卡片: 291×115vp
- 卡片间距: 147vp（第一张到第二张）
- 标题字号: 36vp
- 描述字号: 18vp
- 卡片背景: 白色半透明，圆角

**保留逻辑**:

- 成就数据加载
- 成就解锁状态显示
- AchievementService逻辑

## 实施步骤

### 阶段1: 准备工作

1. 备份现有页面代码
2. 验证所有图片资源路径
3. 创建统一的布局组件（导航栏、返回按钮）

### 阶段2: 页面重写（按顺序）

1. 挑战模式页面
2. 自定义模式页面
3. 冒险模式页面
4. 扫雷游戏页面
5. 设置页面
6. 成就页面

### 阶段3: 代码清理

1. 删除所有震动反馈代码
2. 删除除放大镜外的道具代码
3. 清理未使用的import

### 阶段4: 代码质量检查

1. 确保符合历史文档中的所有规范
2. 最终Linter检查

## 关键注意事项

1. **绝对不修改的逻辑**:

   - GameViewModel所有游戏逻辑
   - AudioManager音乐系统
   - AchievementService成就系统
   - AdventureService冒险系统
   - 所有@State状态变量的业务逻辑
   - 所有点击事件的跳转逻辑

2. **只修改的内容**:

   - 组件布局方式（改为Stack+position）
   - 位置和尺寸数值
   - 图片路径更新
   - 字体应用方式

3. **删除的内容**:

   - 所有震动相关代码（vibrator相关）
   - 除放大镜外的道具UI和逻辑

4. **主题切换页面** (需要监听主题变化):

   - 挑战模式
   - 自定义模式
   - 冒险模式

### To-dos

- [ ] 验证所有图片资源路径是否正确存在
- [ ] 备份现有的6个页面文件代码
- [ ] 重写挑战模式页面(LevelSelectScreen.ets)布局
- [ ] 重写自定义模式页面布局
- [ ] 重写冒险模式页面(AdventureMapScreen.ets)布局
- [ ] 重写扫雷游戏页面(GameBoard.ets + GameHUD.ets)布局
- [ ] 重写设置页面(SettingsScreen.ets)布局
- [ ] 重写成就页面(AchievementsScreen.ets)布局
- [ ] 删除所有震动反馈相关代码
- [ ] 删除除放大镜外的其他道具代码
- [ ] 编译测试和Linter检查
- [ ] 真机功能测试验证