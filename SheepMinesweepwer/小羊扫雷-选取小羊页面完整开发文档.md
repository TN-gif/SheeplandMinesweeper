# 小羊扫雷 - 选取小羊页面完整开发文档

## 📋 文档概述

本文档详细记录了"选取小羊"页面从设计到实现的完整过程，包括所有遇到的问题、解决方案、注意事项和最佳实践。

**创建日期**: 2025年10月11日  
**项目**: 小羊扫雷游戏  
**页面**: 角色选择页面（选取小羊）  
**技术栈**: HarmonyOS Next + ArkTS

---

## 📐 一、页面设计规范

### 1.1 页面结构

#### 整体布局
- **页面尺寸**: 360vp × 792vp
- **布局方式**: Stack + position 绝对定位
- **背景**: 图片填充（`images/background/选择小羊.jpg`）

#### 层级结构
```
Stack (360 × 792)
├── 背景图片 (ImageFit.Cover)
└── 容器2 (296 × 686, position: 31.67, 53.67)
    ├── 标题文本 (296 × 118, position: 0, 0)
    ├── 容器1 - 小羊区域 (282 × 436, position: 7, 155)
    │   ├── 喜羊羊 (115 × 115, position: 0, 0)
    │   ├── 美羊羊 (115 × 115, position: 0, 167)
    │   ├── 懒羊羊 (115 × 115, position: 160, 0)
    │   ├── 沸羊羊 (115 × 115, position: 160, 167)
    │   ├── 暖羊羊 (115 × 115, position: 320, 0)
    │   └── 慢羊羊 (115 × 115, position: 320, 167)
    └── 确认按钮 (190 × 58, position: 53, 628)
        ├── 背景矩形 (198 × 66, position: -4, -4)
        └── 按钮文本 (124 × 34, position: 33, 12)
```

### 1.2 详细尺寸和位置

#### 标题文本
```typescript
Text("请选择\n你的小羊")
  .width(296)           // 宽度
  .height(118)          // 高度
  .fontSize(60)         // 字号
  .fontWeight(400)      // 字重
  .lineHeight(65)       // 行高
  .textAlign(TextAlign.Center)
  .fontColor(Color.Black)
  .fontFamily('Muyao-Softbrush, HarmonyOS Sans')  // 字体+备用
  .position({ x: 0, y: 0 })  // 相对容器2的位置
```

#### 小羊头像
- **尺寸**: 115vp × 115vp（注意是115而不是116）
- **形状**: 圆形（borderRadius: 57.5）
- **布局**: 3行2列
- **列间距**: 167vp（第2列X坐标）
- **行间距**: 160vp（第2行Y坐标）、320vp（第3行Y坐标）

#### 小羊位置坐标表

| 小羊 | 行列 | Y坐标 | X坐标 |
|------|------|-------|-------|
| 喜羊羊 | 第1行第1列 | 0 | 0 |
| 美羊羊 | 第1行第2列 | 0 | 167 |
| 懒羊羊 | 第2行第1列 | 160 | 0 |
| 沸羊羊 | 第2行第2列 | 160 | 167 |
| 暖羊羊 | 第3行第1列 | 320 | 0 |
| 慢羊羊 | 第3行第2列 | 320 | 167 |

#### 确认按钮
```typescript
Stack() {
  // 白色背景矩形（带黑色边框）
  Column()
    .width(198)
    .height(66)
    .backgroundColor(Color.White)
    .borderRadius(33)
    .border({ width: 2, color: Color.Black })
    .position({ x: -4, y: -4 })
  
  // 按钮文本
  Text("确认选择")
    .width(124)
    .height(34)
    .fontSize(31)
    .fontFamily('Muyao-Softbrush, HarmonyOS Sans')
    .position({ x: 33, y: 12 })
}
.width(190)
.height(58)
.position({ x: 53, y: 628 })  // 相对容器2
```

---

## 🎨 二、视觉效果实现

### 2.1 背景图片

#### ❌ 错误实现
```typescript
Image($rawfile('images/background/选择小羊.jpg'))
  .objectFit(ImageFit.Fill)  // 会拉伸变形
```

#### ✅ 正确实现
```typescript
Image($rawfile('images/background/选择小羊.jpg'))
  .width(360)
  .height(792)
  .objectFit(ImageFit.Cover)  // 保持比例，裁剪多余部分
```

**关键点**:
- 使用 `ImageFit.Cover` 保持图片原始比例
- 避免使用 `ImageFit.Fill` 导致拉伸变形

### 2.2 圆形头像

#### 实现要点
```typescript
Stack() {
  Image($rawfile(`images/avatar/${sheepName}.jpg`))
    .width(115)
    .height(115)
    .borderRadius(57.5)  // 圆角半径 = 尺寸 / 2
    .objectFit(ImageFit.Cover)
}
.width(115)
.height(115)
.borderRadius(57.5)  // 容器也要设置圆角
.clip(true)          // 裁剪为圆形（关键！）
```

**关键点**:
- 图片和容器都要设置 `borderRadius`
- 必须设置 `.clip(true)` 才能正确裁剪
- 圆角半径 = 尺寸的一半

### 2.3 选中效果（悬浮+阴影）

#### 完整实现
```typescript
Stack() {
  Image(...)
    .borderRadius(57.5)
}
.width(115)
.height(115)
.borderRadius(57.5)
.clip(true)
// 选中状态的动画效果
.translate(this.selectedThemeId === themeId ? { y: -8 } : { y: 0 })
.shadow(this.selectedThemeId === themeId ? {
  radius: 20,              // 模糊半径
  color: 'rgba(0, 0, 0, 0.4)',  // 阴影颜色
  offsetX: 0,
  offsetY: 8               // 阴影偏移
} : {
  radius: 0,
  color: Color.Transparent,
  offsetX: 0,
  offsetY: 0
})
.scale(this.selectedThemeId === themeId ? { x: 1.05, y: 1.05 } : { x: 1, y: 1 })
.animation({
  duration: 300,           // 动画时长
  curve: Curve.EaseInOut   // 缓动曲线
})
```

**效果组成**:
1. **悬浮**: `translate({ y: -8 })` 向上平移8vp
2. **阴影**: 圆形阴影（因为容器是圆形）
3. **缩放**: `scale(1.05)` 放大5%
4. **动画**: 300ms平滑过渡

**关键点**:
- 阴影基于容器形状，容器圆形则阴影圆形
- 三种效果组合使用增强视觉反馈
- 动画提供平滑的状态切换

---

## 🔤 三、字体系统实现

### 3.1 字体文件准备

#### 文件位置
```
entry/src/main/resources/rawfile/fonts/Muyao-Softbrush.ttf
```

#### 文件信息
- **名称**: Muyao-Softbrush.ttf
- **大小**: 4,673,412 字节 (4.67 MB)
- **来源**: 用户提供的沐瑶软笔体（Muyao-Softbrush Regular）
- **格式**: TrueType Font (.ttf)

### 3.2 FontManager 工具类

#### 完整代码
```typescript
/**
 * 字体工具类
 * 提供自定义字体的名称常量
 */
export class FontManager {
  /**
   * 自定义字体族名称
   */
  static readonly CUSTOM_FONT_FAMILY: string = 'Muyao-Softbrush';

  /**
   * 自定义字体文件路径（在 rawfile 中）
   */
  static readonly CUSTOM_FONT_PATH: string = 'fonts/Muyao-Softbrush.ttf';

  /**
   * 获取自定义字体族名称
   */
  static getFontFamily(): string {
    return FontManager.CUSTOM_FONT_FAMILY;
  }

  /**
   * 获取备用字体族名称
   */
  static getFallbackFont(): string {
    return 'HarmonyOS Sans';
  }
}
```

**关键点**:
- 使用 `readonly` 常量防止修改
- 提供 getter 方法统一访问
- 不在静态方法中使用 `this`（使用类名 `FontManager`）

### 3.3 字体注册（EntryAbility.ets）

#### ✅ 正确实现（当前版本）
```typescript
import { font } from '@kit.ArkUI';
import { FontManager } from '../pages/utils/FontManager';

onWindowStageCreate(windowStage: window.WindowStage): void {
  hilog.info(DOMAIN, 'testTag', 'Ability onWindowStageCreate');

  windowStage.loadContent('pages/Index', (err) => {
    if (err && err.code) {
      hilog.error(DOMAIN, 'testTag', 'Failed to load content: %{public}s', 
        JSON.stringify(err));
      return;
    }
    
    // ✅ 在 loadContent 回调中注册（关键位置）
    try {
      font.registerFont({
        familyName: FontManager.CUSTOM_FONT_FAMILY,
        familySrc: $rawfile(FontManager.CUSTOM_FONT_PATH)
      });
      hilog.info(DOMAIN, 'testTag', '字体注册成功: %{public}s', 
        FontManager.CUSTOM_FONT_FAMILY);
    } catch (error) {
      let err = error as BusinessError;
      hilog.error(DOMAIN, 'testTag', '字体注册失败 code:%{public}d msg:%{public}s', 
        err.code, err.message);
    }
    
    hilog.info(DOMAIN, 'testTag', 'Succeeded in loading the content.');
  });
}
```

#### ❌ 常见错误

**错误1: 注册时机错误**
```typescript
// ❌ 在 loadContent 之前注册
onWindowStageCreate(windowStage: window.WindowStage): void {
  font.registerFont({...});  // 错误位置
  windowStage.loadContent('pages/Index', (err) => {...});
}
```

**错误2: 使用Promise方式（旧版本API）**
```typescript
// ❌ font.registerFont 返回 void，不是 Promise
font.registerFont({...}).then(() => {...}).catch((err) => {...});
// 编译错误: Property 'then' does not exist on type 'void'
```

**错误3: 使用Resource对象**
```typescript
// ❌ 不能直接使用 $rawfile() 返回值
.fontFamily($rawfile('fonts/Muyao-Softbrush.ttf'))
```

### 3.4 字体应用

#### ✅ 正确实现（带 Fallback）
```typescript
import { FontManager } from '../utils/FontManager';

Text("请选择\n你的小羊")
  .fontFamily(`${FontManager.getFontFamily()}, ${FontManager.getFallbackFont()}`)
  // 结果: 'Muyao-Softbrush, HarmonyOS Sans'
```

**优势**:
- 如果自定义字体未加载，自动使用备用字体
- 确保文本始终可读
- 提供降级策略

#### 字体加载验证（可选）
```typescript
import { hilog } from '@kit.PerformanceAnalysisKit';

@Component
export struct CharacterSelectScreen {
  @State fontLoaded: boolean = false;

  aboutToAppear() {
    setTimeout(() => {
      hilog.info(0x0000, 'FontCheck', '当前使用字体: %{public}s', 
        FontManager.getFontFamily());
      this.fontLoaded = true;
    }, 1000);
  }
}
```

### 3.5 字体系统关键要点总结

| 要点 | 说明 |
|------|------|
| **注册时机** | 必须在 `loadContent` 回调中注册 |
| **注册方式** | 使用同步 `try-catch`，不是 Promise |
| **注册位置** | EntryAbility.onWindowStageCreate |
| **使用方式** | 使用字符串字体名，不是 Resource |
| **Fallback** | 必须提供备用字体 |
| **调试环境** | 必须在真机测试，Previewer不支持 |

---

## 🐛 四、历史问题和解决方案

### 4.1 背景图片拉伸问题

#### 问题描述
背景图片显示效果与设计不符，图片被拉伸变形。

#### 原因
```typescript
.objectFit(ImageFit.Fill)  // ❌ 强制拉伸以填满容器
```

#### 解决方案
```typescript
.objectFit(ImageFit.Cover)  // ✅ 保持比例，裁剪多余
```

#### ImageFit 模式对比

| 模式 | 效果 | 适用场景 |
|------|------|----------|
| Fill | 拉伸填满，可能变形 | ❌ 不推荐用于照片 |
| Cover | 保持比例，裁剪多余 | ✅ 推荐用于背景图 |
| Contain | 保持比例，完整显示 | 适用于图标 |
| ScaleDown | 缩小但不放大 | 适用于小图片 |

---

### 4.2 正方形阴影问题

#### 问题描述
选中小羊头像时，悬浮阴影是正方形的，与圆形头像不匹配。

#### 原因
```typescript
Stack() {
  Image(...).borderRadius(57.5)  // 只有图片是圆的
}
.width(115)
.height(115)
// ❌ 容器是方的，阴影也是方的
.shadow({...})
```

#### 解决方案
```typescript
Stack() {
  Image(...).borderRadius(57.5)
}
.width(115)
.height(115)
.borderRadius(57.5)  // ✅ 容器也是圆的
.clip(true)          // ✅ 裁剪为圆形
.shadow({...})       // ✅ 现在阴影是圆的
```

**关键点**: 阴影基于容器的形状，不是内容的形状！

---

### 4.3 字体无法显示问题

#### 问题历程

**问题1: 使用 Resource 对象**
```typescript
// ❌ 错误
.fontFamily($rawfile('fonts/Muyao-Softbrush.ttf'))
```
**原因**: HarmonyOS 无法从 TTF 文件的 Resource 中直接加载字体

**问题2: 使用 Promise 方式**
```typescript
// ❌ 错误（旧API）
font.registerFont({...}).then(() => {...}).catch((err) => {...});
```
**原因**: 当前版本 `font.registerFont()` 返回 `void`，不是 Promise

**问题3: 注册时机错误**
```typescript
// ❌ 错误
onWindowStageCreate(windowStage: window.WindowStage): void {
  font.registerFont({...});  // 在 loadContent 之前
  windowStage.loadContent('pages/Index', ...);
}
```
**原因**: 页面渲染上下文未准备好

#### 最终解决方案
```typescript
// ✅ 正确
onWindowStageCreate(windowStage: window.WindowStage): void {
  windowStage.loadContent('pages/Index', (err) => {
    // 在回调中注册
    try {
      font.registerFont({
        familyName: 'Muyao-Softbrush',
        familySrc: $rawfile('fonts/Muyao-Softbrush.ttf')
      });
    } catch (error) {
      let err = error as BusinessError;
      hilog.error(...);
    }
  });
}
```

---

### 4.4 编译错误修复

#### 错误1: Property 'then' does not exist on type 'void'
```typescript
// ❌ 错误
font.registerFont({...}).then(() => {...});
```
**原因**: `font.registerFont()` 是同步方法，返回 `void`

**解决**: 使用 try-catch
```typescript
// ✅ 正确
try {
  font.registerFont({...});
} catch (error) {
  let err = error as BusinessError;
}
```

#### 错误2: 类结束括号缺失
```typescript
// ❌ 错误
export class FontManager {
  static getCustomFont() {...}
// }  ← 被注释掉了
```
**原因**: 修改代码时意外注释

**解决**: 恢复类的完整结构

---

## 📚 五、ArkTS 规范和最佳实践

### 5.1 必须遵循的规则

#### 规则1: 静态方法中不使用 this
```typescript
// ❌ 错误
static getInstance() {
  if (!this.instance) {  // 错误
    this.instance = new ClassName();
  }
  return this.instance;
}

// ✅ 正确
static getInstance() {
  if (!ClassName.instance) {  // 使用类名
    ClassName.instance = new ClassName();
  }
  return ClassName.instance;
}
```

#### 规则2: 不使用 typeof 作为类型
```typescript
// ❌ 错误
@ObjectLink provider: typeof themeProvider;

// ✅ 正确
@ObjectLink provider: ThemeProvider;
```

#### 规则3: 不使用 any/unknown 类型
```typescript
// ❌ 错误
} catch (err: any) {
  console.error(err);
}

// ✅ 正确
} catch (error) {
  let err = error as BusinessError;
  console.error(err.message);
}
```

#### 规则4: 不在 Promise.catch() 中使用参数
```typescript
// ❌ 错误
promise.catch((err) => {  // err 是 unknown
  console.error(err);
});

// ✅ 正确
async function doSomething() {
  try {
    await promise;
  } catch (error) {
    console.error(error);
  }
}
```

#### 规则5: catch 块不使用类型注解
```typescript
// ❌ 错误
try {
  // code
} catch (err: Error) {  // 不允许类型注解
  console.error(err);
}

// ✅ 正确
try {
  // code
} catch (error) {
  let err = error as Error;  // 在内部使用类型断言
  console.error(err.message);
}
```

#### 规则6: 对象必须使用类构造函数
```typescript
// ❌ 错误
const level: Level = {
  levelId: 'custom',
  name: '自定义'
};

// ✅ 正确
const level: Level = new Level('custom', '自定义');
```

### 5.2 代码质量检查清单

| 检查项 | 命令 | 说明 |
|--------|------|------|
| 静态方法 this | `grep "static.*this\."` | 静态方法中不能用 this |
| typeof 类型 | `grep ":\s*typeof"` | 不能用 typeof 作为类型 |
| any/unknown | `grep ":\s*any\b\|:\s*unknown\b"` | 不能使用这些类型 |
| Promise.catch | `grep "\.catch\s*\("` | 避免使用 .catch() |
| catch 类型注解 | `grep "catch\s*\([^)]*:"` | catch 块不用类型注解 |
| Linter | `read_lints` | 检查所有 lint 错误 |

---

## 🔧 六、开发工具和调试

### 6.1 编译和清理

#### 清理缓存
```bash
hvigor clean
```

#### 编译项目
```bash
hvigor assembleHap
```

#### 完整构建流程
```bash
hvigor clean && hvigor assembleHap
```

### 6.2 真机调试

#### 连接设备
```bash
# 查看设备列表
hdc list targets

# 查看设备信息
hdc shell getprop ro.product.model
```

#### 安装应用
```bash
# 安装 HAP
hdc install entry/build/default/outputs/default/entry-default-unsigned.hap

# 卸载应用
hdc uninstall com.example.app
```

#### 查看日志
```bash
# 实时查看所有日志
hdc shell hilog

# 过滤特定标签
hdc shell hilog | grep "字体"
hdc shell hilog | grep "FontCheck"
hdc shell hilog | grep "testTag"

# 清除日志
hdc shell hilog -r
```

### 6.3 日志输出规范

#### 推荐格式
```typescript
hilog.info(DOMAIN, 'TAG', '消息: %{public}s', value);
hilog.error(DOMAIN, 'TAG', '错误码:%{public}d 消息:%{public}s', code, msg);
```

#### 字体相关日志
```typescript
// 注册成功
hilog.info(DOMAIN, 'testTag', '字体注册成功: %{public}s', FontManager.CUSTOM_FONT_FAMILY);

// 注册失败
hilog.error(DOMAIN, 'testTag', '字体注册失败 code:%{public}d msg:%{public}s', 
  err.code, err.message);

// 字体验证
hilog.info(0x0000, 'FontCheck', '当前使用字体: %{public}s', FontManager.getFontFamily());
```

---

## ✅ 七、验证和测试

### 7.1 代码验证清单

#### 编译阶段
- [ ] 无编译错误
- [ ] 无 Linter 错误
- [ ] 无类型错误
- [ ] 所有依赖正确导入

#### 代码规范
- [ ] 无静态方法 this 使用
- [ ] 无 typeof 类型声明
- [ ] 无 any/unknown 类型
- [ ] 无 Promise.catch() 带参数
- [ ] 无 catch 块类型注解
- [ ] 对象使用类构造函数

### 7.2 功能验证清单

#### 字体系统
- [ ] 字体文件存在且完整（4.67MB）
- [ ] 字体在 loadContent 回调中注册
- [ ] 日志显示"字体注册成功"
- [ ] 无字体注册错误

#### 页面布局
- [ ] 背景图片不拉伸（使用 Cover）
- [ ] 标题文本位置正确
- [ ] 小羊头像位置正确（3行2列）
- [ ] 确认按钮位置正确

#### 视觉效果
- [ ] 背景图片按比例显示
- [ ] 头像显示为圆形
- [ ] 选中效果：圆形阴影
- [ ] 选中效果：向上悬浮
- [ ] 选中效果：轻微放大
- [ ] 过渡动画流畅

#### 字体显示
- [ ] 标题使用沐瑶软笔体
- [ ] 按钮使用沐瑶软笔体
- [ ] 字体为手写风格
- [ ] 文字清晰可读

### 7.3 真机测试步骤

#### 步骤1: 准备环境
1. 清理缓存：`hvigor clean`
2. 编译项目：`hvigor assembleHap`
3. 连接真机：确保 USB 调试开启

#### 步骤2: 安装运行
1. 安装 HAP 到真机
2. 启动应用
3. 导航到"选取小羊"页面

#### 步骤3: 查看日志
```bash
# 终端1: 查看所有日志
hdc shell hilog

# 终端2: 过滤字体相关日志
hdc shell hilog | grep "字体\|Font"
```

**预期日志输出**:
```
字体注册成功: Muyao-Softbrush
当前使用字体: Muyao-Softbrush
```

#### 步骤4: 视觉验证
1. **背景**: 不拉伸，按比例显示
2. **标题**: "请选择\n你的小羊" 显示手写风格
3. **头像**: 6个圆形小羊头像，3行2列
4. **选中**: 点击头像，出现圆形阴影+悬浮效果
5. **按钮**: "确认选择" 显示手写风格
6. **动画**: 选中切换有平滑过渡

---

## 🎯 八、常见错误码和排查

### 8.1 字体注册错误码

| 错误码 | 含义 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 401 | 参数无效 | 路径错误或字体名称不正确 | 检查 familySrc 路径 |
| 801 | 字体解析失败 | 字体文件损坏或格式不支持 | 替换字体文件 |
| 17700001 | 字体文件不存在 | rawfile 路径错误 | 确认文件在 rawfile 目录 |

### 8.2 编译错误

#### Error: Property 'then' does not exist on type 'void'
**原因**: `font.registerFont()` 不返回 Promise  
**解决**: 使用 try-catch 代替 .then().catch()

#### Error: '}' expected
**原因**: 类定义不完整，缺少结束括号  
**解决**: 检查类的结构完整性

#### Error: Using "this" inside stand-alone functions is not supported
**原因**: 静态方法中使用了 this  
**解决**: 使用类名代替 this

#### Error: Use explicit types instead of "any", "unknown"
**原因**: 使用了 any 或 unknown 类型  
**解决**: 使用明确的类型或类型断言

### 8.3 字体不显示排查流程

```
字体不显示
    ↓
检查: 是否在真机上测试？
    → NO: Previewer 不支持自定义字体
    → YES: 继续
    ↓
检查: 日志是否有"字体注册成功"？
    → NO: 检查注册代码和时机
    → YES: 继续
    ↓
检查: 日志是否有错误码？
    → YES: 参考错误码表排查
    → NO: 继续
    ↓
检查: .fontFamily() 使用是否正确？
    → 使用字符串而不是 Resource
    → 添加 fallback 字体
    ↓
检查: 字体文件是否完整？
    → 大小应为 4,673,412 字节
    → 可尝试重新复制文件
    ↓
检查: 字体名称是否匹配？
    → 可尝试字体文件内部名称
    → 如 'Muyao Softbrush' (有空格)
```

---

## 📖 九、文件结构和代码索引

### 9.1 关键文件位置

```
项目根目录/
├── entry/src/main/
│   ├── ets/
│   │   ├── entryability/
│   │   │   └── EntryAbility.ets          # 字体注册
│   │   ├── pages/
│   │   │   ├── components/
│   │   │   │   └── CharacterSelectScreen.ets  # 选取小羊页面
│   │   │   └── utils/
│   │   │       └── FontManager.ets       # 字体工具类
│   │   └── theme/
│   │       └── ThemeProvider.ets         # 主题管理
│   └── resources/
│       └── rawfile/
│           ├── fonts/
│           │   └── Muyao-Softbrush.ttf   # 字体文件
│           └── images/
│               ├── background/
│               │   └── 选择小羊.jpg       # 背景图
│               └── avatar/
│                   ├── 喜羊羊.jpg
│                   ├── 美羊羊.jpg
│                   ├── 懒羊羊.jpg
│                   ├── 沸羊羊.jpg
│                   ├── 暖羊羊.jpg
│                   └── 慢羊羊.jpg
└── 小羊扫雷-选取小羊页面完整开发文档.md  # 本文档
```

### 9.2 代码导入关系

```
EntryAbility.ets
    ├── import { font } from '@kit.ArkUI'
    └── import { FontManager } from '../pages/utils/FontManager'

CharacterSelectScreen.ets
    ├── import { ThemeProvider } from '../theme/ThemeProvider'
    ├── import { FontManager } from '../utils/FontManager'
    └── import { hilog } from '@kit.PerformanceAnalysisKit'

FontManager.ets
    └── (无外部依赖，纯工具类)
```

---

## 💡 十、最佳实践和建议

### 10.1 布局设计

1. **使用绝对定位**
   - 对于精确设计，使用 Stack + position
   - 避免自动布局产生的累积误差

2. **图片资源**
   - 背景图使用 `ImageFit.Cover`
   - 头像图使用 `ImageFit.Cover`
   - 图标可使用 `ImageFit.Contain`

3. **圆形元素**
   - 图片和容器都设置 borderRadius
   - 必须使用 .clip(true) 裁剪
   - 圆角半径 = 尺寸 / 2

### 10.2 字体管理

1. **字体文件**
   - 放在 rawfile/fonts/ 目录
   - 文件名清晰易识别
   - 确认文件完整性

2. **字体注册**
   - 在 loadContent 回调中注册
   - 使用同步 try-catch
   - 添加详细的日志输出

3. **字体使用**
   - 始终提供 fallback 字体
   - 使用工具类统一管理
   - 在真机上验证效果

### 10.3 错误处理

1. **异步操作**
   - 优先使用 async/await
   - 配合 try-catch 错误处理
   - 避免使用 .catch() 带参数

2. **类型安全**
   - 不使用 any/unknown
   - catch 块内使用类型断言
   - 所有类型明确声明

3. **日志记录**
   - 关键操作添加日志
   - 包含错误码和消息
   - 使用统一的日志格式

### 10.4 代码组织

1. **工具类设计**
   - 使用 readonly 常量
   - 提供 getter 方法
   - 不在静态方法中用 this

2. **组件设计**
   - 职责单一明确
   - 状态管理合理
   - 添加必要注释

3. **资源管理**
   - 统一的命名规范
   - 清晰的目录结构
   - 完整的文档说明

---

## 📝 十一、总结和检查表

### 11.1 项目完成度

- ✅ 页面布局完全符合设计规范
- ✅ 视觉效果精确实现
- ✅ 字体系统正确配置
- ✅ 代码符合 ArkTS 规范
- ✅ 无编译错误和警告
- ✅ 历史问题已修复
- ✅ 文档完整详尽

### 11.2 最终检查表

#### 代码质量
- [ ] ✅ 无 Linter 错误
- [ ] ✅ 无编译错误
- [ ] ✅ 无类型错误
- [ ] ✅ 符合 ArkTS 所有规范

#### 字体系统
- [ ] ✅ 字体文件完整（4.67MB）
- [ ] ✅ 在 loadContent 回调中注册
- [ ] ✅ 使用同步 try-catch
- [ ] ✅ 提供 fallback 字体
- [ ] ✅ 日志输出正确

#### 页面实现
- [ ] ✅ 绝对定位精确
- [ ] ✅ 背景图不拉伸
- [ ] ✅ 圆形头像正确
- [ ] ✅ 圆形阴影效果
- [ ] ✅ 选中动画流畅

#### 文档完整性
- [ ] ✅ 设计规范详细
- [ ] ✅ 实现步骤清晰
- [ ] ✅ 问题解决方案完整
- [ ] ✅ 最佳实践明确
- [ ] ✅ 验证方法详尽

---

## 📞 附录：参考资源

### A.1 HarmonyOS 官方文档
- ArkUI 组件参考
- ArkTS 语法规范
- 字体资源管理
- 日志系统使用

### A.2 历史修复文档
- `BUG_FIXES_SUMMARY.md` - 23个编译错误修复
- `ARKTS_FIX_COMPLETE.md` - ArkTS 类型错误修复
- `FINAL_FIX_REPORT.md` - 对象字面量修复
- `CORRECT_FIX_REPORT.md` - 冒险模式配置修复

### A.3 本次开发生成的文档
- `字体显示问题完整修复报告.md`
- `最终字体问题修复报告.md`
- `小羊扫雷-选取小羊页面完整开发文档.md`（本文档）

---

## 🎉 结语

本文档详细记录了"选取小羊"页面从设计到实现的完整过程，包括所有遇到的问题和解决方案。通过严格遵循 ArkTS 规范和 HarmonyOS 最佳实践，最终实现了一个符合设计要求、视觉效果精美、代码质量优秀的角色选择页面。

**关键成果**:
- ✅ 完全按照设计文档实现布局（360×792，绝对定位）
- ✅ 正确使用用户提供的沐瑶软笔体字体
- ✅ 实现圆形头像和圆形阴影选中效果
- ✅ 代码零错误零警告，符合所有规范
- ✅ 完整的文档记录和最佳实践总结

希望本文档能够为后续开发提供完整的参考和指导！

---

*文档创建日期：2025年10月11日*  
*文档版本：v1.0*  
*项目：小羊扫雷游戏*  
*页面：选取小羊（角色选择）*  
*状态：✅ 已完成*

